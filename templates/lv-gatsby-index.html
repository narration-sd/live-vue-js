<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
    .lv-iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    </style>

</head>
<body>
<noscript>
    <strong>We're sorry but Live Vue doesn't work properly without JavaScript
        enabled. Please enable it to continue.</strong>
</noscript>
<script>
// var gatsbySite = "http://localhost:8001//page-5" // *todo* for now, before Settings routing
// var gatsbySite = 'https://localhost/page-5' // *todo* for now, before Settings routing
var gatsbySite = "https://lv-gatsby.test/page-5" // *todo* for now, before Settings routing
</script>
{% hook "live-vue" %}
<script>
    var iframeElem = document.createElement('iframe')
    iframeElem.src = gatsbySite
    iframeElem.id = 'ifrm'
    iframeElem.className = 'lv-iframe'
    iframeElem.name = 'live-vue-frame'
    document.body.appendChild(iframeElem)
</script>
{#<iframe id="ifrm" name="live-vue" class="lv-iframe"#}
{#        src="https://localhost/page-5"></iframe>#}
{#<iframe id="ifrm" name="live-vue" class="lv-iframe" src="https://lv-gatsby.test/page-5"></iframe>#}
{#<iframe id="ifrm" name="live-vue" class="lv-iframe" src="https://localhost/page-5"></iframe>#}
{#<iframe id="ifrm" name="live-vue" class="lv-iframe" ></iframe>#}
<script>
// document.getElementById('ifrm').src = gatsbySite
document.write('<div style="position: absolute; bottom: 5px; background: lightcoral;"><h6 style="margin: 2px 5px;">we are here</h6></div>')
</script>
<script>
function pushMessage () {

  var msg = // { text: 'from our Craft parent' }
    { text: document.getElementById('liveVue').innerText }
  // get reference to window in iframe
  console.log('preparing: ' + msg.text)
  var frame = iframeElem // document.getElementById('ifrm')
  console.log('sending: ' + msg.text + ', to:' + frame.name)
  var win = frame.contentWindow
  // post msg to win - but remember, otherwise mayn't touch it
  // because CSRF rules as this iframe src is on another site
  win.postMessage(msg, '*')
}

function tickDelayPush () {
  console.log('beginning tick timeout')
  // *todo* with the full-js iframe build, do we need any time, or just tick?
  setTimeout(pushMessage, 0) // *todo* even this, actually one tick, is enough??

}

window.addEventListener('load', tickDelayPush, false)
</script>
</body>
</html>
